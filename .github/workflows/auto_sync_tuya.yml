name: Sincronizzazione Reale Core (Forzata)
on:
  workflow_dispatch:

jobs:
  sync-core:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout tuo repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configura Git
        run: |
          git config user.name "GitHub Action Bot"
          git config user.email "action@github.com"

      - name: Download File Core Ufficiale
        run: |
          # Elimina il file locale esistente
          rm -f custom_components/tuya/climate.py
          
          # Scarica la versione ufficiale
          mkdir -p custom_components/tuya/
          curl -L https://raw.githubusercontent.com/home-assistant/core/dev/homeassistant/components/tuya/climate.py \
            -o custom_components/tuya/climate.py
          
          # Verifica download
          if [ ! -f custom_components/tuya/climate.py ]; then
            echo "‚ùå Errore: File non scaricato"
            exit 1
          fi
          
          echo "‚úÖ File scaricato: $(wc -l < custom_components/tuya/climate.py) righe"

      - name: Crea Pull Request
        uses: peter-evans/create-pull-request@v6 # Usa v6, pi√π recente
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: temp-upstream-compare
          delete-branch: true # Elimina il branch dopo il merge
          base: main
          commit-message: "üîÑ Sostituzione con versione Core ufficiale"
          title: "‚ö†Ô∏è CONFLITTO ATTESO: Allineamento Core"
          body: |
            ## üìã Descrizione
            
            Questa PR contiene la versione **vergine** del file `climate.py` dal repository ufficiale Home Assistant Core.
            
            ### üéØ Obiettivo
            Confrontare le modifiche Cecotec con la versione upstream per identificare conflitti.
            
            ### ‚öôÔ∏è Cosa √® stato fatto
            - ‚úÖ Eliminato il file locale esistente
            - ‚úÖ Scaricato `climate.py` da `home-assistant/core@dev`
            - ‚úÖ Creato branch `temp-upstream-compare`
            
            ### ‚ö†Ô∏è Conflitti Attesi
            GitHub dovrebbe mostrare automaticamente i conflitti tra:
            - Le tue modifiche per i dispositivi Cecotec
            - La versione ufficiale del Core
            
            ### üìù Prossimi Passi
            1. Rivedi i conflitti nella tab "Files changed"
            2. Risolvi manualmente i conflitti mantenendo le modifiche Cecotec
            3. Testa il codice risultante
            
            ---
            *Generato automaticamente da GitHub Actions*
          labels: |
            sync
            needs-review